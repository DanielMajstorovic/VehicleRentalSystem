<div class="container-fluid">
  <h3 class="fw-bold">Clients Management</h3>

  <div class="d-flex flex-wrap gap-2 align-items-center mt-3 mb-3">
    <div class="input-group" style="max-width: 260px">
      <input
        type="text"
        class="form-control"
        placeholder="Search…"
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()"
      />
      <button class="btn btn-primary" (click)="onSearch()">
        <i class="bi bi-search"></i>
      </button>
    </div>

    <select
      class="form-select ms-auto"
      style="width: 180px"
      [(ngModel)]="deletedFilter"
      (change)="onFilterChange(deletedFilter)"
    >
      <option value="">All</option>
      <option value="0">Active</option>
      <option value="1">Blocked</option>
    </select>
  </div>

  <div class="table-responsive bg-white rounded shadow-sm">
    <table class="table table-striped mb-0">
      <thead class="thead-dark">
        <tr>
          <th>Username</th>
          <th>First</th>
          <th>Last</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Status</th>
          <th style="width: 90px">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of data">
          <td>{{ c.userUsername }}</td>
          <td>{{ c.userFirstName }}</td>
          <td>{{ c.userLastName }}</td>
          <td>{{ c.email }}</td>
          <td>{{ c.phone }}</td>
          <td>
            <span
              class="badge"
              [ngClass]="c.userDeleted === 0 ? 'bg-success' : 'bg-danger'"
            >
              {{ c.userDeleted === 0 ? "Active" : "Blocked" }}
            </span>
          </td>
          <td>
            <div class="d-flex justify-content-between">
              <button
                class="btn btn-sm btn-outline-secondary me-1"
                (click)="openDetails(c)"
                title="View client details"
              >
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-secondary" (click)="toggle(c)" title="Toggle client status">
                <i class="bi bi-toggle-off"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="data.length === 0">
          <td colspan="7" class="text-center text-muted">No clients found.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-2">
    <small
      >Page {{ page + 1 }} / {{ totalPages }} – {{ totalElements }} items</small
    >
    <div>
      <button
        class="btn btn-outline-secondary btn-sm me-1"
        [disabled]="page === 0"
        (click)="go(page - 1)"
      >
        <i class="bi bi-chevron-left"></i> Prev
      </button>
      <button
        class="btn btn-outline-secondary btn-sm"
        [disabled]="page >= totalPages - 1"
        (click)="go(page + 1)"
      >
        Next <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<div
  class="modal fade"
  tabindex="-1"
  role="dialog"
  [ngClass]="{ 'show d-block': showDetails }"
  *ngIf="showDetails"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Client details</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeDetails()"
        ></button>
      </div>

      <div class="modal-body">
        <div class="text-center mb-3">
          <img
            [src]="avatarUrl"
            (error)="onAvatarError($event)"
            class="rounded-circle shadow"
            style="width: 120px; height: 120px"
          />
        </div>

        <table class="table table-sm">
          <tbody>
            <tr>
              <th>Username</th>
              <td>{{ selected.userUsername }}</td>
            </tr>
            <tr>
              <th>Name</th>
              <td>{{ selected.userFirstName }} {{ selected.userLastName }}</td>
            </tr>
            <tr>
              <th>Email</th>
              <td>{{ selected.email }}</td>
            </tr>
            <tr>
              <th>Phone</th>
              <td>{{ selected.phone }}</td>
            </tr>
            <tr *ngIf="selected.iDNumber">
              <th>ID Number</th>
              <td>{{ selected.iDNumber }}</td>
            </tr>
            <tr *ngIf="selected.passportNumber">
              <th>Passport</th>
              <td>{{ selected.passportNumber }}</td>
            </tr>
            <tr>
              <th>Balance</th>
              <td>{{ selected.balance | currency : "USD" }}</td>
            </tr>
            <tr>
              <th>Status</th>
              <td>
                <span
                  class="badge"
                  [ngClass]="
                    selected.userDeleted === 0 ? 'bg-success' : 'bg-danger'
                  "
                >
                  {{ selected.userDeleted === 0 ? "Active" : "Blocked" }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline-secondary" (click)="closeDetails()">
          Close
        </button>
        <button
          class="btn"
          [ngClass]="selected.userDeleted === 0 ? 'btn-danger' : 'btn-success'"
          (click)="toggle(selected)"
        >
          {{ selected.userDeleted === 0 ? "Block" : "Activate" }}
        </button>
      </div>
    </div>
  </div>
</div>
<div
  class="modal-backdrop fade show"
  *ngIf="showDetails"
  (click)="closeDetails()"
></div>
