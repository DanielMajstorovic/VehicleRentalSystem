<div class="container-fluid">
  <h3 class="fw-bold">Employees Management</h3>

  <div class="d-flex justify-content-between align-items-center mt-3 mb-3">
    <div>
      <div class="input-group me-2 d-inline-flex align-items-center">
        <input
          type="text"
          class="form-control"
          placeholder="Search…"
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
        />
        <button class="btn btn-primary" (click)="onSearch()">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>
    <div>
      <button class="btn btn-success" (click)="openCreateModal()">
        <i class="bi bi-plus-lg"></i> New Employee
      </button>
    </div>
  </div>

  <div class="table-responsive bg-white rounded shadow-sm">
    <table class="table table-striped mb-0">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Username</th>
          <th scope="col">First name</th>
          <th scope="col">Last name</th>
          <th scope="col">Role</th>
          <th scope="col" style="width: 80px">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let e of employees">
          <td>{{ e.userUsername }}</td>
          <td>{{ e.userFirstName }}</td>
          <td>{{ e.userLastName }}</td>
          <td>{{ e.role }}</td>
          <td>
            <div class="d-flex justify-content-between">
              <button
                class="btn btn-sm btn-outline-secondary me-1"
                (click)="openUpdateModal(e)"
              >
                <i class="fas fa-file-pen"></i>
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="onDelete(e.id, e.userUsername)"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="employees.length === 0">
          <td colspan="5" class="text-center text-muted">
            No employees found.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-2">
    <small>
      Showing page {{ currentPage + 1 }} of {{ totalPages }} – Total items:
      {{ totalElements }}
    </small>
    <div>
      <button
        class="btn btn-outline-secondary btn-sm me-1"
        [disabled]="currentPage === 0"
        (click)="goToPage(currentPage - 1)"
      >
        <i class="bi bi-chevron-left"></i> Prev
      </button>
      <button
        class="btn btn-outline-secondary btn-sm"
        [disabled]="currentPage >= totalPages - 1"
        (click)="goToPage(currentPage + 1)"
      >
        Next <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<div
  class="modal fade"
  tabindex="-1"
  role="dialog"
  [ngClass]="{ 'show d-block': showCreateModal }"
  *ngIf="showCreateModal"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">New Employee</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeCreateModal()"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createForm" novalidate>
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">Username</label>
              <input
                type="text"
                class="form-control"
                formControlName="userUsername"
                [ngClass]="{ 'is-invalid': isInvalid(createForm, 'userUsername') }"
              />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Password</label>
              <input
                type="password"
                class="form-control"
                formControlName="userPassword"
                [ngClass]="{ 'is-invalid': isInvalid(createForm, 'userPassword') }"
              />
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">First name</label>
              <input
                type="text"
                class="form-control"
                formControlName="userFirstName"
                [ngClass]="{ 'is-invalid': isInvalid(createForm, 'userFirstName') }"
              />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Last name</label>
              <input
                type="text"
                class="form-control"
                formControlName="userLastName"
                [ngClass]="{ 'is-invalid': isInvalid(createForm, 'userLastName') }"
              />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Role</label>
            <select
              class="form-select"
              formControlName="role"
              [ngClass]="{ 'is-invalid': isInvalid(createForm, 'role') }"
            >
              <option value="" disabled>-- select --</option>
              <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" (click)="closeCreateModal()">
          Close
        </button>
        <button class="btn btn-primary" (click)="onCreate()">Create</button>
      </div>
    </div>
  </div>
</div>
<div
  class="modal-backdrop fade show"
  *ngIf="showCreateModal"
  (click)="closeCreateModal()"
></div>

<div
  class="modal fade"
  tabindex="-1"
  role="dialog"
  [ngClass]="{ 'show d-block': showUpdateModal }"
  *ngIf="showUpdateModal"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update Employee</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeUpdateModal()"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="updateForm" novalidate>
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">First name</label>
              <input
                type="text"
                class="form-control"
                formControlName="userFirstName"
                [ngClass]="{ 'is-invalid': isInvalid(updateForm, 'userFirstName') }"
              />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Last name</label>
              <input
                type="text"
                class="form-control"
                formControlName="userLastName"
                [ngClass]="{ 'is-invalid': isInvalid(updateForm, 'userLastName') }"
              />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Role</label>
            <select
              class="form-select"
              formControlName="role"
              [ngClass]="{ 'is-invalid': isInvalid(updateForm, 'role') }"
            >
              <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">New password (optional)</label>
            <input
              type="password"
              class="form-control"
              formControlName="userPassword"
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" (click)="closeUpdateModal()">
          Close
        </button>
        <button class="btn btn-primary" (click)="onUpdate()">Save</button>
      </div>
    </div>
  </div>
</div>
<div
  class="modal-backdrop fade show"
  *ngIf="showUpdateModal"
  (click)="closeUpdateModal()"
></div>
